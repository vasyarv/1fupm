##Файлы и работа с ними

###Введение

Если коротко: файл - именованная область данных на носителе информации.

Для удобства работы с ними каждая операционная система имеет файловую систему, определяющу порядок хранения, доступа и создания файлов.

В Windows и Linux файловые системы разные (в каждой из них возможны как минимум 3 разные файловые системы).
Как правило файловая система состоит из блоков (от 512байт), которые группируются в файлы операционной системой. 
Возможны так же виртуальные файловые системы и сетевые. 

Иерархическая структура файлов в Wndows:
```
C:
  \Program files
      \CDEx
           \CDEx.exe
           \CDEx.hlp
           \mppenc.exe
  \Мои документы
      \Wiki.txt
      \Tornado.jpg
D:
  \Music
      \ABBA
           \1974 Waterloo
           \1976 Arrival
               \Money, Money, Money.ogg
           \1977 The Album
(Иерархическая файловая система Windows/DOS)
```

Иерархическая структура файлов в Unix системах:
```
/
    /usr                                  
        /bin                              
            /arch                        
            /ls                         
            /raw                     
        /lib                           
            /libhistory.so.5.2           
            /libgpm.so.1                
    /home                                
        /lost+found                      
            /host.sh                    
        /guest                         
            /Pictures                   
                /example.png        
            /Video                     
                /matrix.avi            
                /news                
                    /lost_ship.mpeg    
```

В Unix системах имеется ОДНА корневая точка. 
Так же ~ обозначает домашнюю директорию.
И слэш смотрит в другую сторону.

###Права доступа к файлам

Каждый файл в ОС UNIX содержит набор прав доступа, по которому определяется, как пользователь взаимодействует с данным файлом. 
Этот набор хранится в индексном дескрипторе данного файла в виде целого значения, из которого обычно используется 12 битов. 
Причем каждый бит используется как переключатель, разрешая (значение 1) или запрещая (значение 0) тот или иной доступ.

Три первых бита устанавливают различные виды поведения при выполнении. 
Оставшиеся девять делятся на три группы по три, определяя права доступа для владельца, группы и остальных пользователей. Каждая группа задает права на чтение, запись и выполнение.

Базовые биты прав доступа представлены в таблице ниже. 
Там дано восьмеричное значение, задающее соответствующий бит, вид этого бита в первом столбце длинного листинга и право, задаваемое этим битом.

| Восьмеричное значение | Вид в столбце прав доступа | Право или назначение бита                                                     |
|-----------------------|----------------------------|-------------------------------------------------------------------------------|
| 4000                  | ---s------                 | Установленный эффективный идентификатор владельца (бит SUID)                  |
| 2000                  | ------s---                 | Установленный эффективный идентификатор группы (бит SПID)                     |
| 1000                  | ---------t---------T       | Клейкий (sticky) бит. Вид для каталогов и выполняемых файлов, соответственно. |
| 0400                  | -r--------                 | Право владельца на чтение                                                     |
| 0200                  | --w-------                 | Право владельца на запись                                                     |
| 0100                  | ---x------                 | Право владельца на выполнение                                                 |
| 0040                  | ----r-----                 | Право группы на чтение                                                        |
| 0020                  | -----w----                 | Право группы на запись                                                        |
| 0010                  | ------x---                 | Право группы на выполнение                                                    |
| 0004                  | -------r--                 | Право всех прочих на чтение                                                   |
| 0002                  | --------w-                 | Право всех прочих на запись                                                   |
| 0001                  | ---------x                 | Право всех прочих на выполнение                                               |


Бит чтения для всех типов файлов имеет одно и то же значение: он позволяет читать содержимое файла (получать листинг каталога командой ls).

Бит записи также имеет одно и то же значение: он позволяет писать в этот файл, включая и перезапись содержимого. Если у пользователя отсутствует право доступа на запись в каталоге, где находится данный файл, то пользователь не сможет его удалить. Аналогично, без этого же права пользователь не создаст новый файл в каталоге, хотя может сократить длину доступного на запись файла до нуля.

Если для некоторого файла установлен бит выполнения, то файл может выполняться как команда. В случае установки этого бита для каталога, этот каталог можно сделать текущим (перейти в него командой cd).

Установленный бит SUID означает, что доступный пользователю на выполнение файл будет выполняться с правами (с эффективным идентификатором) владельца, а не пользователя, вызвавшего файл (как это обычно происходит).

Установленный бит SGID означает, что доступный пользователю на выполнение файл будет выполняться с правами (с эффективным идентификатором) группы-владельца, а не пользователя, вызвавшего файл (как это обычно происходит).

Если бит SGID установлен для файла, не доступного для выполнения, он означает обязательное блокирование, т.е. неизменность прав доступа на чтение и запись пока файл открыт определенной программой.

Установленный клейкий бит для обычных файлов ранее (во времена PDP-11) означал необходимость сохранить образ программы в памяти после выполнения (для ускорения повторной загрузки). Сейчас при установке обычным пользователем он сбрасывается. Значение этого бита при установке пользователем root зависит от версии ОС и иногда необходимо. Так, в ОС Solaris необходимо устанавливать клейкий бит для обычных файлов, используемых в качестве области подкачки.

Установка клейкого бита для каталога означает, что файл в этом каталоге может быть удален или переименован только в следующих случаях:

  1. пользователем-владельцем файла;
  2. пользователем-владельцем каталога;
  3. если файл доступен пользователю на запись;
  4. пользователем root.

Для расчета прав доступа необходимо сложить восьмеричные значения всех необходимых установленных битов. В результате получится четырехзначное восьмеричное число. Если старший разряд имеет значение 0, его можно не указывать.

Например, если необходимо задать права доступа на чтение, запись и выполнение для владельца, на чтение и выполнение для группы и на выполнение для всех остальных пользователей, получаем следующее восьмеричное значение:

Чтение для владельца:	0400
Запись для владельца:	0200
Выполнение для владельца:	0100
Чтение для группы:	0040
Выполнение для группы:	0010
Выполнение для прочих:	0001
Сумма:	0751
Итак, соответствующие права доступа - 751. В длинном листинге эти права будут представлены в виде "-rwxr-x--x" (при "сложении" буквы с дефисом в символьном представлении остается буква).
