Структура программы

Программы в Linux состоят из секций, каждая из которых имеет свое назначение. 

екция .text содержит код программы. 

Секции .data и .bss содержат данные. 
Причем первая содержит инициализированные данные, а вторая — не инициализированные. 
Секция .data всегда включается при компиляции в исполняемый файл, а .bss в исполняемый файл не включается и создается только при загрузке процесса в оперативную память. 

Начало секции объявляется директивой SECTION имя_секции. 
Вместо директивы SECTION можно использовать директиву SEGMENT. 
Для указания конца секции директив не существует — секция автоматически заканчивается приобъявлении новой секции или в конце программы. 
Порядок следования секций в программе не имеет значения. 
В программе обязательно должна быть объявлена метка с именем main (или _start) – это точка входа в программу. 
Кроме того, метка точки входа должна быть объявлена как глобальный идентификатор директивой GLOBAL main. 

Пример программы HELLO WORLD

```asm
.data                         /* поместить следующее в сегмент данных
                                                                    */
 
hello_str:                    /* наша строка                        */
        .string "Hello, world!\n"
 
                              /* длина строки                       */
        .set hello_str_length, . - hello_str - 1
 
.text                         /* поместить следующее в сегмент кода */
 
.globl  main                  /* main - глобальный символ, видимый
                                 за пределами текущего файла        */
.type   main, @function       /* main - функция (а не данные)       */
 
 
main:
        movl    $4, %eax      /* поместить номер системного вызова
                                 write = 4 в регистр %eax           */
 
        movl    $1, %ebx      /* первый параметр - в регистр %ebx;
                                 номер файлового дескриптора 
                                 stdout - 1                         */
 
        movl    $hello_str, %ecx  /* второй параметр - в регистр %ecx;
                                     указатель на строку            */
 
        movl    $hello_str_length, %edx /* третий параметр - в регистр
                                           %edx; длина строки       */
 
        int     $0x80         /* вызвать прерывание 0x80            */
 
        movl    $1, %eax      /* номер системного вызова exit - 1   */
        movl    $0, %ebx      /* передать 0 как значение параметра  */
        int     $0x80         /* вызвать exit(0)                    */
 
        .size   main, . - main    /* размер функции main            */
```

Компиляция:
```bash
gcc file.s -o file
```

В случае использование _start вместо main нужно компилить:

```bash
gcc -c file.s
ld -s -o file file.o
```

Некоторые секции:

1. .text — скомпилированный машинный код

2. .data — глобальные и статические переменные;

3. .rodata — аналог .data для неизменяемых данных;

4. .bss — глобальные и статические переменные, которые при старте содержат нулевое значение. Секция bss используется как место для хранения глобальных переменных. Вы можете выделить адресное пространство для секции bss, но Вы не можете указать, какие данные будут загружены в нее до исполнения программы. Когда пpогpамма начинает pаботy, секция bss заполнена нулями.

##Данные
Существуют директивы ассемблера, которые размещают в памяти данные, определенные программистом. Аргументы этих директив — список выражений, разделенных запятыми.

.byte — размещает каждое выражение как 1 байт;

.short — 2 байта;

.long — 4 байта;

.quad — 8 байт.


Например:

.byte   0x10, 0xf5, 0x42, 0x55

.long   0xaabbaabb

.short  -123, 456

Также существуют директивы для размещения в памяти строковых литералов:

.ascii "STR" размещает строку STR. Нулевых байтов не добавляет.

.string "STR" размещает строку STR, после которой следует нулевой байт (как в языке Си).

У директивы .string есть синоним .asciz (z от англ. zero — ноль, указывает на добавление нулевого байта).

Строка-аргумент этих директив может содержать стандартные escape-последовательности, которые вы использовали в Си, например, \n, \r, \t, \\, \" и так далее.

Данные нужно помещать в секцию .data.
